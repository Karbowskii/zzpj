<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
            http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd">

    <changeSet id="1" author="sd">
        <createTable tableName="authority">
            <column name="id" type="bigint" autoIncrement="true" >
                <constraints primaryKey="true" nullable="false"  />
            </column>
            <column name="name" type="varchar(10)">
                <constraints  nullable="false" />
            </column>
        </createTable>
    </changeSet>

    <changeSet id="2" author="sd">
        <createTable tableName="level">
            <column name="id" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="expToNextLevel" type="int" defaultValue="1">
                <constraints  nullable="false" />
            </column>
            <column name="maxBets" type="int" defaultValue="1">
                <constraints  nullable="false" />
            </column>
        </createTable>
    </changeSet>

    <changeSet id="3" author="sd">
        <createTable tableName="users">
            <column name="id" type="bigint" autoIncrement="true" >
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="username" type="varchar(20)" >
                <constraints  nullable="false" />
            </column>
            <column name="password" type="varchar(20)" >
                <constraints  nullable="false" />
            </column>
            <column name="email" type="varchar(30)" >
                <constraints  nullable="false" />
            </column>
            <column name="firstName" type="varchar(20)" >
                <constraints  nullable="false" />
            </column>
            <column name="lastName" type="varchar(20)" >
                <constraints  nullable="false" />
            </column>
            <column name="isActive" type="boolean" defaultValueBoolean="true" />
            <column name="exp" type="int" defaultValue="0" />
            <column name="level" type="bigint" >
                <constraints  nullable="false" />
            </column>
            <column name="coins" type="int" defaultValue="100" />
        </createTable>

        <createTable tableName="user_authority">
            <column name="authority_id" type="bigint">
                <constraints nullable="false" />
            </column>
            <column name="user_id" type="bigint">
                <constraints nullable="false" />
            </column>
        </createTable>

        <addForeignKeyConstraint constraintName="fk_authority"
                                 baseTableName="user_authority" baseColumnNames="authority_id"
                                 referencedTableName="authority" referencedColumnNames="id" />
        <addForeignKeyConstraint constraintName="fk_user"
                                 baseTableName="user_authority" baseColumnNames="user_id"
                                 referencedTableName="users" referencedColumnNames="id" />

        <addForeignKeyConstraint constraintName="fk_level"
                                 baseTableName="users" baseColumnNames="level"
                                 referencedTableName="level" referencedColumnNames="id" />
    </changeSet>

    <changeSet id="4" author="sd">
        <createTable tableName="matches" >
            <column name="id" type="bigint" autoIncrement="true" >
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="startDate" type="date" >
                <constraints  nullable="false" />
            </column>
            <column name="realId" type="int" >
                <constraints  nullable="false" />
            </column>
            <column name="idFinished" type="boolean" defaultValueBoolean="false" />
            <column name="realScoreA" type="int" defaultValue="0" >
                <constraints  nullable="false" />
            </column>
            <column name="realScoreB" type="int" defaultValue="0" >
                <constraints  nullable="false" />
            </column>
            <column name="stakeA" type="int" defaultValue="1" >
                <constraints  nullable="false" />
            </column>
            <column name="stakeB" type="int" defaultValue="1" >
                <constraints  nullable="false" />
            </column>
        </createTable>
    </changeSet>

    <changeSet id="5" author="sd">
        <createTable tableName="comments">
            <column name="id" type="bigint" autoIncrement="true" >
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="dateOfCreation" type="date" >
                <constraints  nullable="false" />
            </column>
            <column name="user_id" type="bigint" >
                <constraints  nullable="false" />
            </column>
            <column name="match_id" type="bigint" >
                <constraints  nullable="false" />
            </column>
            <column name="text" type="varchar(1500)" />
        </createTable>


        <addForeignKeyConstraint constraintName="fk_users"
                                 baseTableName="comments" baseColumnNames="user_id"
                                 referencedTableName="users" referencedColumnNames="id" />

        <addForeignKeyConstraint constraintName="fk_match"
                                 baseTableName="comments" baseColumnNames="match_id"
                                 referencedTableName="match" referencedColumnNames="id" />
    </changeSet>

    <changeSet id="6" author="sd">
        <createTable tableName="bets">
            <column name="id" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="match_id" type="long" >
                <constraints  nullable="false" />
            </column>
            <column name="scoreA" type="int" >
                <constraints  nullable="false" />
            </column>
            <column name="scoreB" type="int" >
                <constraints  nullable="false" />
            </column>
            <column name="coins" type="int" >
                <constraints  nullable="false" />
            </column>
        </createTable>

        <createTable tableName="bets_users">
            <column name="user_id" type="bigint">
                <constraints nullable="false" />
            </column>
            <column name="bet_id" type="bigint">
                <constraints nullable="false" />
            </column>
        </createTable>

        <addForeignKeyConstraint constraintName="fk_users"
                                 baseTableName="bets_users" baseColumnNames="user_id"
                                 referencedTableName="users" referencedColumnNames="id" />
        <addForeignKeyConstraint constraintName="fk_bets"
                                 baseTableName="bets_users" baseColumnNames="bet_id"
                                 referencedTableName="bets" referencedColumnNames="id" />

        <addForeignKeyConstraint constraintName="fk_match"
                                 baseTableName="bets" baseColumnNames="match_id"
                                 referencedTableName="match" referencedColumnNames="id" />
    </changeSet>

</databaseChangeLog>